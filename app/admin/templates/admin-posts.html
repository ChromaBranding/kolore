{% extends 'admin-base.html'%}
{% block content %}
    <div class="card fadeInUp hide">
        <div class="title group">
            <h3 class="light left">{{_("All")}} <b>{{_("Posts")}}</b></h3>
            <a class="btn btn-small btn-blue btn-outline right" href="{{url_for('admin.add_post')}}">
                <i class="fa fa-plus"></i>&nbsp;&nbsp;{{_("Add Post")}}
            </a>
        </div>
        <table class="table-hovered">
            <thead>
                <tr>
                    <th>{{_("Post")}}</th>
                    <th>{{_("Published")}}</th>
                    <th>{{_("Categories")}}</th>
                    <th>{{_("Actions")}}</th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                <tr id="{{ post.key.id() }}">
                    <td><a href="/blog/{{post.url}}" class="title">{{post.title}}</a></td>
                    <td><span class="date" data-date="{{post.date}}" data-format="LL"></span></td>
                    <td>{% for category in post.get_categories() %}<span class="label">{{category}}</span> {% endfor %}</td>
                    <td>
                        <span class="btn-group">
                            <a class="btn btn-smaller btn-outline" href="/blog/{{post.url}}"><i class="fa fa-eye"></i></a>
                            <a class="btn btn-smaller btn-blue btn-outline" href="{{ url_for('admin.edit_post', post_id=post.key.id())}}"><i class="fa fa-pencil"></i></a>
                            <button class="btn btn-smaller btn-red btn-outline delete-modal" data-id="{{post.key.id()}}"><i class="fa fa-trash-o"></i></button>
                        </span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% include 'blocks/block-modal.html' %}
{% endblock %}
{% block js %}
    <script type="application/javascript">
        // set Locale Lang
        moment.locale('{{request.cookies.get('lang')}}');

        // Set dates
        [].forEach.call(document.querySelectorAll('.date'), function(item){
            item.innerHTML = moment(item.dataset.date, "YYYY-MM-DD HH:mm:ss.SSSSSS").add(1, 'h').fromNow();
        });

        // Set modal listener
        [].forEach.call(document.querySelectorAll('.delete-modal'), function(item){
            item.addEventListener('click', function() {
                var title = item.parentNode.parentNode.parentNode.querySelector('.title').innerText,
                    content = '{{_("Are you sure you want to delete this post")}}',
                    action = '{{_("Delete")}}',
                    postId = item.dataset.id;

                populateModal(title, content, action, postId);
                openModal();
                document.querySelector('#modal-action').addEventListener('click', deletePostModalRequest);
            });
        });

        // Set modal closing listeners
        document.querySelector('.modal-box').addEventListener('click', function(event){
            if (this.classList.contains('modal-box') && event.target.classList.contains('modal-box')) {
                closeModal();
                document.querySelector('#modal-action').removeEventListener('click', deletePostModalRequest);
            }
        });

        // Modal closing listener
        [].forEach.call(document.querySelectorAll('.modal-close-action'), function(item){
            item.addEventListener('click', function(event) {
                closeModal();
                document.querySelector('#modal-action').removeEventListener('click', deletePostModalRequest);
            });
        });


    </script>
{% endblock %}